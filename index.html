<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="theme-color" content="#0a0f1a" id="meta-theme"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="Ramadan"/>
<link rel="manifest" href="/ramadhan/manifest.json"/>
<link rel="apple-touch-icon" href="/ramadhan/icons/icon-192.png"/>
<title>Ramadan 1447H</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
:root{--bg:#0a0f1a;--bg2:#111827;--card:rgba(255,255,255,0.05);--cardB:rgba(255,255,255,0.09);--text:#f0ede6;--sub:rgba(240,237,230,0.55);--mute:rgba(240,237,230,0.32);--nav:#0b1020;--navB:rgba(212,175,55,0.18);--inp:rgba(255,255,255,0.07);--inpB:rgba(255,255,255,0.14);--div:rgba(255,255,255,0.07);--gold:#d4af37;--goldT:#f5e198;--goldD:rgba(212,175,55,0.82);--acc:rgba(212,175,55,0.13);--accB:rgba(212,175,55,0.35);--modal:#0d1728;--hero1:#0d1a2e;--hero2:#162035;--hero3:#0f1e0e;--cnt:#f5e198;--slabel:rgba(240,237,230,0.38);--divRow:rgba(255,255,255,0.018);--blueBg:rgba(32,100,180,0.14);--blueT:#93c5fd;--greenBg:rgba(20,80,45,0.22);--greenB:rgba(32,178,95,0.18);--tabIco:rgba(240,237,230,0.32)}
.light{--bg:#f7f2e8;--bg2:#fefcf7;--card:rgba(255,255,255,0.88);--cardB:rgba(180,140,50,0.18);--text:#1c1408;--sub:rgba(28,20,8,0.6);--mute:rgba(28,20,8,0.37);--nav:#faf7f0;--navB:rgba(180,140,50,0.22);--inp:rgba(255,255,255,0.8);--inpB:rgba(160,120,40,0.24);--div:rgba(160,120,40,0.1);--gold:#b37f00;--goldT:#8a6000;--goldD:rgba(140,100,0,0.88);--acc:rgba(180,140,50,0.1);--accB:rgba(160,120,40,0.3);--modal:#fefcf7;--hero1:#fffdf4;--hero2:#fffaec;--hero3:#f5f2e0;--cnt:#8a6000;--slabel:rgba(28,20,8,0.4);--divRow:rgba(0,0,0,0.018);--blueBg:rgba(32,100,180,0.07);--blueT:#2563eb;--greenBg:rgba(20,120,60,0.07);--greenB:rgba(32,160,80,0.18);--tabIco:rgba(28,20,8,0.35)}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
html,body{height:100%;overflow:hidden;font-family:'Outfit',sans-serif;background:#0a0f1a;color:var(--text)}
::-webkit-scrollbar{display:none}

/* SPLASH ‚Äî pakai CSS transition bukan JS opacity agar selalu bisa disembunyikan */
#splash{position:fixed;inset:0;background:#0a0f1a;z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;overflow:hidden;transition:opacity .5s,transform .5s}
#splash.hide{opacity:0;transform:translateY(-20px);pointer-events:none}
#splash-canvas{position:absolute;inset:0;pointer-events:none}
.splash-moon{font-size:68px;display:block}
.splash-title{font-size:26px;font-weight:700;color:#d4af37;letter-spacing:1px}
.splash-sub{font-size:13px;color:rgba(212,175,55,0.55);font-family:'Amiri',serif}
.splash-dots{display:flex;gap:8px}
.splash-dot{width:8px;height:8px;border-radius:50%;background:#d4af37}

/* APP ‚Äî SELALU VISIBLE, animasi hanya bonus */
.app{display:flex;flex-direction:column;height:100dvh;max-width:430px;margin:0 auto;background:var(--bg);position:relative;overflow:hidden;transition:background .35s}
#stars-canvas{position:fixed;top:0;left:0;pointer-events:none;z-index:0;max-width:430px;left:50%;transform:translateX(-50%);opacity:.55}
.topbar,.content,.bottom-nav{position:relative;z-index:1}
.geo{background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='rgba(212,175,55,0.05)' stroke-width='1'%3E%3Cpolygon points='30,2 58,17 58,43 30,58 2,43 2,17'/%3E%3Cpolygon points='30,12 48,22 48,38 30,48 12,38 12,22'/%3E%3C/g%3E%3C/svg%3E")}
.app.light #stars-canvas{opacity:.18}

.topbar{flex-shrink:0;display:flex;justify-content:space-between;align-items:center;padding:10px 18px;padding-top:max(10px,env(safe-area-inset-top));background:var(--nav);border-bottom:1px solid var(--navB);backdrop-filter:blur(12px)}
.app-title{color:var(--goldD);font-size:12px;font-weight:700;letter-spacing:.5px}
.top-right{display:flex;align-items:center;gap:10px}
.clock{color:var(--mute);font-size:11px;font-family:monospace}
.theme-toggle{display:flex;align-items:center;gap:5px;cursor:pointer;user-select:none}
.sw-track{width:42px;height:24px;border-radius:12px;background:var(--acc);border:1px solid var(--accB);position:relative;cursor:pointer}
.sw-knob{width:18px;height:18px;border-radius:50%;background:var(--gold);position:absolute;top:2px;left:2px;transition:left .28s cubic-bezier(.4,0,.2,1);box-shadow:0 1px 4px rgba(0,0,0,.3)}
.sw-knob.on{left:20px}

.content{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:80px}
.page{display:none;padding:0 15px 20px}
.page.active{display:block}

.bottom-nav{flex-shrink:0;display:flex;background:var(--nav);border-top:1px solid var(--navB);padding:8px 0 max(14px,env(safe-area-inset-bottom));backdrop-filter:blur(12px)}
.tab-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;background:none;border:none;cursor:pointer;padding:4px 0;position:relative}
.tab-btn .ico{font-size:21px;transition:transform .2s}
.tab-btn.active .ico{transform:scale(1.14)}
.tab-btn .lbl{font-size:10px;color:var(--tabIco);font-family:Outfit,sans-serif;font-weight:500;transition:color .2s}
.tab-btn.active .lbl{color:var(--gold);font-weight:700}
.tab-dot{width:4px;height:4px;border-radius:50%;background:var(--gold);margin-top:1px}
.tab-ripple{position:absolute;border-radius:50%;background:rgba(212,175,55,0.18);pointer-events:none}
.float-emoji{position:fixed;pointer-events:none;z-index:500;user-select:none}

.card{background:var(--card);border:1px solid var(--cardB);border-radius:18px;overflow:hidden;margin-bottom:14px}
.section-label{font-size:10px;letter-spacing:2px;color:var(--slabel);font-weight:600;margin:0 0 10px 4px;text-transform:uppercase}

.hero{border-radius:22px;padding:20px;margin:14px 0;border:1px solid var(--accB);background:linear-gradient(135deg,var(--hero1),var(--hero2),var(--hero3));position:relative;overflow:hidden}
.hero-glow{position:absolute;top:-20px;right:-20px;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,rgba(212,175,55,0.16) 0%,transparent 70%);animation:glowP 3s ease-in-out infinite}
.hero-glow2{position:absolute;bottom:-30px;left:-20px;width:100px;height:100px;border-radius:50%;background:radial-gradient(circle,rgba(32,178,95,0.08) 0%,transparent 70%);animation:glowP 4s ease-in-out infinite reverse}
@keyframes glowP{0%,100%{transform:scale(1);opacity:.7}50%{transform:scale(1.25);opacity:1}}
.hero-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}
.hero-date{color:var(--mute);font-size:11px;letter-spacing:1.2px}
.hero-hijri{color:var(--goldD);font-size:11px;margin-top:3px}
.loc-btn{display:flex;align-items:center;gap:4px;background:rgba(255,255,255,.07);border:1px solid var(--cardB);border-radius:12px;padding:5px 10px;cursor:pointer;max-width:145px;transition:transform .15s}
.loc-btn:active{transform:scale(.93)}
.app.light .loc-btn{background:rgba(0,0,0,.05)}
.loc-btn-text{color:var(--sub);font-size:11px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:90px}
.hero-center{text-align:center;padding:8px 0}
.hero-lbl{color:var(--sub);font-size:12px;margin-bottom:6px}
.countdown{font-family:monospace;font-size:44px;font-weight:700;color:var(--cnt);letter-spacing:2px;display:flex;justify-content:center;align-items:center;gap:2px;overflow:hidden}
.cd-seg{display:inline-block;min-width:2ch;text-align:center}
.cd-colon{animation:colonBlink 1s step-end infinite;padding:0 1px}
@keyframes colonBlink{0%,100%{opacity:1}50%{opacity:.2}}
.ram-badge{display:inline-block;background:var(--acc);border:1px solid var(--accB);border-radius:20px;padding:4px 14px;color:var(--gold);font-size:11px;font-weight:700;margin-top:12px}

.prayer-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
.prayer-card{border-radius:18px;padding:14px;border:1px solid var(--cardB);background:var(--card);cursor:pointer;transition:transform .15s,background .25s,border-color .25s}
.prayer-card:active{transform:scale(.94)}
.prayer-card.next{background:var(--acc);border-color:var(--accB)}
.pc-top{display:flex;justify-content:space-between;align-items:center}
.next-badge{background:var(--gold);border-radius:6px;padding:2px 7px;font-size:8px;font-weight:800;color:#0a0f1a;animation:pulseBadge 2s ease-in-out infinite}
@keyframes pulseBadge{0%,100%{box-shadow:0 0 0 0 rgba(212,175,55,.5)}50%{box-shadow:0 0 0 6px rgba(212,175,55,0)}}
.pc-name{color:var(--sub);font-size:11px;margin:8px 0 2px}
.pc-time{font-size:22px;font-weight:700;color:var(--text)}
.prayer-card.next .pc-time{color:var(--cnt)}

.amalan-row{display:flex;align-items:center;padding:13px 14px;border-bottom:1px solid var(--div)}
.amalan-row:last-child{border-bottom:none}
.am-ico{font-size:20px;margin-right:12px;flex-shrink:0}
.am-title{font-size:13px;font-weight:500;color:var(--text)}
.am-sub{font-size:11px;color:var(--mute);margin-top:1px}
.checkbox{width:22px;height:22px;border-radius:50%;border:2px solid var(--accB);flex-shrink:0;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
.checkbox.checked{background:var(--gold);border-color:var(--gold)}
.checkbox.checked::after{content:'‚úì';font-size:12px;color:#0a0f1a;font-weight:800}

.ayat-card{background:var(--greenBg);border:1px solid var(--greenB);border-radius:18px;padding:18px;text-align:center;margin-bottom:16px}
.ayat-ar{font-family:'Amiri',serif;font-size:20px;color:var(--goldD);direction:rtl;line-height:2;margin-bottom:10px}
.ayat-tr{font-size:12px;color:var(--sub);font-style:italic;line-height:1.6}

.pr-row{display:flex;align-items:center;padding:13px 15px;border-bottom:1px solid var(--div)}
.pr-row:last-child{border-bottom:none}
.pr-row.next-row{background:var(--acc)}
.pr-ico{font-size:18px;width:26px;text-align:center;margin-right:11px;flex-shrink:0}
.pr-name{flex:1;font-size:14px;color:var(--text)}
.pr-row.next-row .pr-name,.pr-row.next-row .pr-time{color:var(--cnt);font-weight:600}
.pr-time{font-size:15px;font-weight:600;font-family:monospace;color:var(--text)}

.table-wrap{border:1px solid var(--cardB);border-radius:16px;overflow:hidden;margin-bottom:16px}
.table-head{display:grid;grid-template-columns:28px 1fr 52px 52px 54px;padding:10px 12px;background:var(--acc)}
.th{color:var(--gold);font-size:9px;font-weight:700;letter-spacing:.5px}
.tr{display:grid;grid-template-columns:28px 1fr 52px 52px 54px;padding:10px 12px;border-bottom:1px solid var(--div)}
.tr:last-child{border-bottom:none}
.tr.today-row{background:var(--acc)}
.td{font-size:11px;color:var(--sub)}
.td.num{color:var(--mute)}
.td.buka{color:#f59e0b;font-weight:600}
.app.light .td.buka{color:#b45309}
.tr.today-row .td.num{color:var(--gold);font-weight:700}
.tr.today-row .td.buka{color:var(--gold)}

.kajian-card{cursor:pointer;border-radius:20px;overflow:hidden;margin-bottom:13px;border:1px solid var(--cardB);background:var(--card);transition:transform .15s}
.kajian-card:active{transform:scale(.97)}
.kjt{padding:16px;border-bottom:1px solid var(--div);background:rgba(255,255,255,.025)}
.app.light .kjt{background:rgba(0,0,0,.015)}
.kj-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.cat-badge{border-radius:10px;padding:3px 10px;font-size:10px;font-weight:600;color:var(--sub);background:rgba(255,255,255,.07)}
.app.light .cat-badge{background:rgba(0,0,0,.06)}
.kj-title{font-size:15px;font-weight:700;color:var(--text);line-height:1.4}
.kjb{padding:14px}
.kj-exc{font-size:12px;color:var(--sub);line-height:1.7;margin-bottom:10px}
.kj-footer{display:flex;justify-content:space-between;align-items:center}
.kj-meta{font-size:11px;color:var(--mute)}
.kj-read{font-size:12px;font-weight:600;color:var(--gold)}

.back-btn{display:inline-flex;align-items:center;gap:5px;background:var(--card);border:1px solid var(--cardB);border-radius:12px;padding:9px 14px;cursor:pointer;font-size:12px;color:var(--text);font-family:Outfit,sans-serif;margin:14px 0;transition:transform .15s}
.back-btn:active{transform:scale(.94)}
.detail-card{border:1px solid var(--cardB);border-radius:20px;overflow:hidden}
.detail-head{padding:20px;border-bottom:1px solid var(--div)}
.detail-body{padding:18px;background:var(--card)}
.detail-content{font-size:14px;color:var(--sub);line-height:1.85;white-space:pre-line}

.doa-card{background:var(--card);border:1px solid var(--cardB);border-radius:18px;padding:15px;margin-bottom:11px;cursor:pointer;transition:transform .15s}
.doa-card:active{transform:scale(.97)}
.doa-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.doa-title{font-size:14px;font-weight:600;color:var(--text)}
.doa-ar{font-family:'Amiri',serif;font-size:16px;color:var(--goldD);direction:rtl;line-height:1.9;margin-bottom:6px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.doa-arti{font-size:11px;color:var(--mute);font-style:italic;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.arabic-box{background:rgba(212,175,55,.06);border:1px solid var(--accB);border-radius:14px;padding:18px;margin-bottom:15px}
.app.light .arabic-box{background:rgba(212,175,55,.07)}
.arabic-full{font-family:'Amiri',serif;font-size:22px;color:var(--goldD);direction:rtl;text-align:right;line-height:2.1}
.field-label{font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--mute);font-weight:600;margin-bottom:5px}
.latin-txt{font-size:13px;color:var(--sub);font-style:italic;line-height:1.75;margin-bottom:14px}
.arti-txt{font-size:13px;color:var(--text);line-height:1.75;margin-bottom:17px}
.copy-btn{width:100%;padding:13px;border-radius:13px;border:1px solid var(--accB);background:var(--acc);color:var(--gold);font-size:13px;font-weight:600;cursor:pointer;font-family:Outfit,sans-serif;transition:all .2s}
.copy-btn:active{transform:scale(.97)}
.copy-btn.copied{background:rgba(52,211,153,.18);border-color:#34d399;color:#34d399}

.prog-card{background:var(--blueBg);border:1px solid var(--navB);border-radius:18px;padding:15px;margin-bottom:14px}
.prog-row{display:flex;justify-content:space-between;margin-bottom:7px}
.prog-bar{height:7px;background:var(--cardB);border-radius:5px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,#60a5fa,#93c5fd);border-radius:5px;width:0%;transition:width 1s ease}
.surah-row{display:flex;align-items:center;padding:13px;border-radius:14px;margin-bottom:7px;background:var(--card);border:1px solid var(--cardB);transition:transform .15s;cursor:pointer}
.surah-row:active{transform:scale(.97)}
.surah-num{width:36px;height:36px;border-radius:9px;background:var(--acc);border:1px solid var(--accB);display:flex;align-items:center;justify-content:center;margin-right:12px;flex-shrink:0}
.surah-ar{font-family:'Amiri',serif;font-size:16px;color:var(--goldD);direction:rtl}
.footnote{text-align:center;font-size:12px;color:var(--mute);padding:14px}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(5px);z-index:200;display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal-sheet{background:var(--modal);border-radius:24px 24px 0 0;width:100%;max-width:430px;max-height:88vh;display:flex;flex-direction:column;padding-bottom:env(safe-area-inset-bottom,16px);transform:translateY(100%);transition:transform .36s cubic-bezier(.32,1,.38,1)}
.modal-overlay.open .modal-sheet{transform:translateY(0)}
.modal-handle{display:flex;justify-content:center;padding:12px 0 4px}
.handle{width:38px;height:4px;border-radius:2px;background:rgba(255,255,255,.2)}
.app.light .handle{background:rgba(0,0,0,.15)}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:8px 20px 13px;border-bottom:1px solid var(--div)}
.modal-title{font-size:17px;font-weight:700;color:var(--text)}
.modal-sub{font-size:11px;color:var(--mute);margin-top:3px}
.close-btn{width:30px;height:30px;border-radius:10px;border:none;background:rgba(255,255,255,.08);cursor:pointer;font-size:14px;color:var(--sub);display:flex;align-items:center;justify-content:center;transition:transform .15s}
.close-btn:active{transform:scale(.86)}
.app.light .close-btn{background:rgba(0,0,0,.06)}
.search-wrap{padding:12px 15px 8px;position:relative}
.search-ico{position:absolute;left:26px;top:50%;transform:translateY(-50%);font-size:14px;pointer-events:none}
.search-input{width:100%;background:var(--inp);border:1px solid var(--inpB);border-radius:13px;padding:11px 12px 11px 36px;color:var(--text);font-size:14px;outline:none;font-family:Outfit,sans-serif;transition:border-color .2s,box-shadow .2s}
.search-input:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(212,175,55,.12)}
.modal-list{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch}
.prov-row{display:flex;justify-content:space-between;align-items:center;padding:13px 20px;border-bottom:1px solid var(--div);cursor:pointer;transition:background .12s}
.prov-row:active{background:rgba(255,255,255,.05)}
.prov-left{display:flex;align-items:center;gap:8px}
.prov-name{font-size:13px;font-weight:600;color:var(--text)}
.active-badge{background:var(--acc);border:1px solid var(--accB);border-radius:6px;padding:1px 7px;font-size:9px;font-weight:700;color:var(--gold)}
.prov-right{display:flex;align-items:center;gap:6px}
.prov-count{font-size:11px;color:var(--mute)}
.chevron{font-size:16px;color:var(--mute);transition:transform .22s;display:inline-block}
.chevron.open{transform:rotate(90deg)}
.city-row{display:flex;justify-content:space-between;align-items:center;padding:11px 20px 11px 32px;border-bottom:1px solid var(--div);cursor:pointer;background:rgba(255,255,255,.025);transition:background .12s}
.app.light .city-row{background:rgba(0,0,0,.025)}
.city-row:active{background:rgba(212,175,55,.08)}
.city-name{font-size:13px;color:var(--text)}
.city-name.active-city{color:var(--gold);font-weight:700}
.city-tz{font-size:10px;color:var(--mute);margin-top:2px}
.check{color:var(--gold);font-size:15px}
.empty-search{text-align:center;padding:30px;color:var(--mute);font-size:13px}
.page-header{padding:14px 0 12px}
.page-title{font-size:21px;font-weight:700;color:var(--text)}
.page-sub{font-size:12px;color:var(--mute);margin-top:3px}
.jadwal-header{display:flex;justify-content:space-between;align-items:center;padding:14px 0 12px}
.tz-badge{background:var(--acc);border:1px solid var(--accB);border-radius:10px;padding:5px 12px}
.tz-text{font-size:11px;font-weight:600;color:var(--gold)}
.card-header-strip{padding:12px 16px;background:var(--acc);border-bottom:1px solid var(--div)}
.install-banner{display:none;position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--card);border:1px solid var(--accB);border-radius:16px;padding:13px 18px;max-width:400px;width:calc(100% - 30px);z-index:150;box-shadow:0 4px 24px rgba(0,0,0,.4);align-items:center;gap:12px}
.install-banner.show{display:flex}
.install-txt{flex:1;font-size:13px;color:var(--text)}
.install-txt small{color:var(--mute);font-size:11px;display:block;margin-top:2px}
.install-yes{background:var(--gold);border:none;border-radius:10px;padding:8px 14px;font-size:12px;font-weight:700;color:#0a0f1a;cursor:pointer;font-family:Outfit,sans-serif;white-space:nowrap}
.install-no{background:none;border:none;font-size:18px;color:var(--mute);cursor:pointer}
</style>
</head>
<body>

<div id="splash">
  <canvas id="splash-canvas"></canvas>
  <span class="splash-moon" id="splash-moon">üåô</span>
  <div class="splash-title">Ramadan 1447H</div>
  <div class="splash-sub">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê</div>
  <div class="splash-dots"><div class="splash-dot"></div><div class="splash-dot"></div><div class="splash-dot"></div></div>
</div>

<div class="app geo" id="app">
  <canvas id="stars-canvas"></canvas>
  <div class="topbar">
    <span class="app-title">‚ò™ Ramadan 1447H</span>
    <div class="top-right">
      <span class="clock" id="clock">--:--:--</span>
      <div class="theme-toggle" onclick="toggleTheme()">
        <span id="theme-icon">üåô</span>
        <div class="sw-track"><div class="sw-knob on" id="sw-knob"></div></div>
      </div>
    </div>
  </div>

  <div class="content">
    <!-- HOME -->
    <div class="page active" id="page-home">
      <div class="hero" id="hero">
        <div class="hero-glow"></div><div class="hero-glow2"></div>
        <div class="hero-top">
          <div><div class="hero-date" id="hero-date">‚Äî</div><div class="hero-hijri" id="hero-hijri">‚Äî</div></div>
          <div class="loc-btn" onclick="openModal()">
            <span>üìç</span><span class="loc-btn-text" id="loc-name-home">Surabaya</span><span style="color:var(--gold);font-size:10px">‚ñæ</span>
          </div>
        </div>
        <div class="hero-center">
          <div class="hero-lbl" id="next-label">‚è≥ Memuat...</div>
          <div class="countdown"><span class="cd-seg" id="cd-h">00</span><span class="cd-colon">:</span><span class="cd-seg" id="cd-m">00</span><span class="cd-colon">:</span><span class="cd-seg" id="cd-s">00</span></div>
          <div id="ram-badge-wrap"></div>
        </div>
      </div>
      <div class="section-label">JADWAL HARI INI</div>
      <div class="prayer-grid" id="quick-grid"></div>
      <div class="section-label">AMALAN HARIAN</div>
      <div class="card">
        <div class="amalan-row"><span class="am-ico">üìñ</span><div><div class="am-title">Tilawah Al-Qur'an</div><div class="am-sub">1 Juz per hari</div></div><div style="margin-left:auto"><div class="checkbox" onclick="toggleCheck(this)"></div></div></div>
        <div class="amalan-row"><span class="am-ico">ü§≤</span><div><div class="am-title">Dzikir Pagi &amp; Petang</div><div class="am-sub">Setelah Subuh &amp; Ashar</div></div><div style="margin-left:auto"><div class="checkbox" onclick="toggleCheck(this)"></div></div></div>
        <div class="amalan-row"><span class="am-ico">üíù</span><div><div class="am-title">Sedekah Harian</div><div class="am-sub">Walau sedikit</div></div><div style="margin-left:auto"><div class="checkbox" onclick="toggleCheck(this)"></div></div></div>
        <div class="amalan-row" style="border-bottom:none"><span class="am-ico">üïå</span><div><div class="am-title">Shalat Tarawih</div><div class="am-sub">Berjamaah di masjid</div></div><div style="margin-left:auto"><div class="checkbox" onclick="toggleCheck(this)"></div></div></div>
      </div>
      <div class="ayat-card"><div class="ayat-ar">ÿ¥ŸéŸáŸíÿ±Ÿè ÿ±ŸéŸÖŸéÿ∂ŸéÿßŸÜŸé ÿßŸÑŸéŸëÿ∞ŸêŸä ÿ£ŸèŸÜÿ≤ŸêŸÑŸé ŸÅŸêŸäŸáŸê ÿßŸÑŸíŸÇŸèÿ±Ÿíÿ¢ŸÜŸè</div><div class="ayat-tr">"Bulan Ramadhan yang di dalamnya diturunkan Al-Qur'an..." ‚Äî QS. Al-Baqarah: 185</div></div>
    </div>

    <!-- JADWAL -->
    <div class="page" id="page-jadwal">
      <div class="jadwal-header">
        <div class="page-header" style="padding:14px 0 0"><div class="page-title">Jadwal Sholat</div><div style="display:flex;align-items:center;gap:4px;margin-top:4px;cursor:pointer" onclick="openModal()"><span style="color:var(--goldD);font-size:12px">üìç <span id="loc-name-jadwal">Surabaya</span></span><span style="color:var(--gold);font-size:10px">‚ñæ</span></div></div>
        <div class="tz-badge"><span class="tz-text" id="tz-label">WIB</span></div>
      </div>
      <div class="card" id="today-card"></div>
      <div class="section-label">JADWAL 30 HARI RAMADAN 1447H</div>
      <div class="table-wrap"><div class="table-head"><div class="th">#</div><div class="th">Tanggal</div><div class="th">Imsak</div><div class="th">Subuh</div><div class="th">Buka</div></div><div id="monthly-table"></div></div>
    </div>

    <!-- KAJIAN -->
    <div class="page" id="page-kajian">
      <div id="kajian-list-view"><div class="page-header"><div class="page-title">Blog Kajian</div><div class="page-sub">Ilmu perbekalan Ramadhan</div></div><div id="kajian-list"></div></div>
      <div id="kajian-detail-view" style="display:none"><button class="back-btn" onclick="closeKajian()">‚Üê Kembali</button><div class="detail-card" id="kajian-detail"></div></div>
    </div>

    <!-- DOA -->
    <div class="page" id="page-doa">
      <div id="doa-list-view"><div class="page-header"><div class="page-title">Kumpulan Doa</div><div class="page-sub">Doa-doa pilihan Ramadhan</div></div><div id="doa-list"></div></div>
      <div id="doa-detail-view" style="display:none"><button class="back-btn" onclick="closeDoa()">‚Üê Kembali</button><div id="doa-detail"></div></div>
    </div>

    <!-- QURAN -->
    <div class="page" id="page-quran">
      <div class="page-header"><div class="page-title">Al-Qur'an</div><div class="page-sub">Tilawah harian Ramadhan</div></div>
      <div class="prog-card" id="prog-card"><div style="font-size:12px;color:var(--sub);margin-bottom:8px">Target Khatam Ramadhan</div><div class="prog-row"><span style="font-size:13px;font-weight:600;color:var(--text)" id="prog-text">Belum Dimulai</span><span style="font-size:12px;font-weight:700;color:var(--blueT)" id="prog-pct">0%</span></div><div class="prog-bar"><div class="prog-fill" id="prog-fill"></div></div></div>
      <div id="surah-list"></div>
      <div class="footnote">Untuk membaca lengkap, gunakan aplikasi Al-Qur'an terpisah üìñ</div>
    </div>
  </div>

  <nav class="bottom-nav">
    <button class="tab-btn active" onclick="switchTab('home',this)"><span class="ico">üè†</span><span class="lbl">Beranda</span><div class="tab-dot"></div></button>
    <button class="tab-btn" onclick="switchTab('jadwal',this)"><span class="ico">üïå</span><span class="lbl">Jadwal</span></button>
    <button class="tab-btn" onclick="switchTab('kajian',this)"><span class="ico">üìö</span><span class="lbl">Kajian</span></button>
    <button class="tab-btn" onclick="switchTab('doa',this)"><span class="ico">ü§≤</span><span class="lbl">Doa</span></button>
    <button class="tab-btn" onclick="switchTab('quran',this)"><span class="ico">üìñ</span><span class="lbl">Qur'an</span></button>
  </nav>

  <div class="install-banner" id="install-banner">
    <div class="install-txt">üåô Install Aplikasi Ramadan<small>Tambahkan ke layar utama untuk akses offline</small></div>
    <button class="install-yes" id="install-btn">Install</button>
    <button class="install-no" onclick="document.getElementById('install-banner').classList.remove('show')">‚úï</button>
  </div>

  <div class="modal-overlay" id="loc-modal" onclick="handleOverlayClick(event)">
    <div class="modal-sheet">
      <div class="modal-handle"><div class="handle"></div></div>
      <div class="modal-header">
        <div><div class="modal-title">Pilih Wilayah</div><div class="modal-sub">üìç Saat ini: <strong style="color:var(--gold)" id="modal-current">Surabaya</strong></div></div>
        <button class="close-btn" onclick="closeModal()">‚úï</button>
      </div>
      <div class="search-wrap"><span class="search-ico">üîç</span><input type="text" class="search-input" id="loc-search" placeholder="Cari kota atau provinsi..." oninput="renderSearch()"/></div>
      <div class="modal-list" id="modal-list"></div>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê CONSTANTS ‚ïê‚ïê
const SPLASH=document.getElementById('splash');

// ‚ïê‚ïê ANIME.JS ‚Äî load async, app tetap jalan kalau gagal ‚ïê‚ïê
let A=null; // alias untuk anime
(function(){
  const s=document.createElement('script');
  s.src='https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js';
  s.onload=()=>{A=window.anime;startSplash();};
  s.onerror=()=>{hideSplash();};
  document.head.appendChild(s);
  // Hard fallback: kalau 3.5 detik belum ada, paksa tampilkan app
  setTimeout(hideSplash,3500);
})();

function an(opts){if(A)A(opts);}  // safe wrapper

function hideSplash(){
  SPLASH.classList.add('hide');
  setTimeout(()=>{SPLASH.style.display='none';},600);
  init();
  initStars();
}

// ‚ïê‚ïê SPLASH ANIMATION ‚ïê‚ïê
function startSplash(){
  const cv=document.getElementById('splash-canvas');
  const ctx=cv.getContext('2d');
  cv.width=window.innerWidth;cv.height=window.innerHeight;
  const stars=Array.from({length:70},()=>({x:Math.random()*cv.width,y:Math.random()*cv.height,r:Math.random()*1.8+.4,a:Math.random()*.6+.1}));
  const loop=setInterval(()=>{
    ctx.clearRect(0,0,cv.width,cv.height);
    stars.forEach(s=>{ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fillStyle=`rgba(212,175,55,${s.a})`;ctx.fill();s.a+=(Math.random()*.02-.01);s.a=Math.max(.05,Math.min(.9,s.a));});
  },50);

  A({targets:'#splash-moon',scale:[0,1.15,1],rotate:['-20deg','4deg','0deg'],opacity:[0,1],duration:850,easing:'spring(1,80,10,0)'});
  A({targets:'#splash-moon',translateY:[-7,7],duration:1800,direction:'alternate',loop:true,easing:'easeInOutSine'});
  A({targets:'.splash-title',opacity:[0,1],translateY:[14,0],duration:550,delay:350,easing:'easeOutCubic'});
  A({targets:'.splash-sub',opacity:[0,1],duration:450,delay:600,easing:'easeOutCubic'});
  A({targets:'.splash-dot',scale:[0,1],delay:A.stagger(110,{start:750}),easing:'spring(1,80,10,0)'});
  setTimeout(()=>A({targets:'.splash-dot',scale:[1,1.5,1],delay:A.stagger(140),duration:480,loop:true,easing:'easeInOutSine'}),1100);

  setTimeout(()=>{
    clearInterval(loop);
    A({targets:'#splash',opacity:[1,0],translateY:[0,-18],duration:480,easing:'easeInCubic',complete:()=>{
      SPLASH.style.display='none';
      init();
      initStars();
      // Entrance animations
      A({targets:'.topbar',translateY:[-16,0],opacity:[0,1],duration:420,easing:'easeOutCubic'});
      A({targets:'.bottom-nav',translateY:[16,0],opacity:[0,1],duration:420,easing:'easeOutCubic'});
      setTimeout(animateHome,180);
    }});
  },2200);
}

// ‚ïê‚ïê STARS ‚ïê‚ïê
function initStars(){
  const cv=document.getElementById('stars-canvas');
  const ctx=cv.getContext('2d');
  const resize=()=>{cv.width=Math.min(430,window.innerWidth);cv.height=window.innerHeight;};
  resize();window.addEventListener('resize',resize);
  const pts=Array.from({length:22},()=>({x:Math.random()*cv.width,y:Math.random()*cv.height,vy:-(Math.random()*.22+.06),vx:(Math.random()-.5)*.07,size:Math.random()*1.3+.4,a:0,maxA:Math.random()*.3+.07,grow:true}));
  (function draw(){
    ctx.clearRect(0,0,cv.width,cv.height);
    pts.forEach(p=>{
      ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fillStyle=`rgba(212,175,55,${p.a})`;ctx.fill();
      p.y+=p.vy;p.x+=p.vx;
      if(p.grow){p.a+=.003;if(p.a>=p.maxA)p.grow=false;}else{p.a-=.003;if(p.a<=0){p.y=cv.height;p.x=Math.random()*cv.width;p.a=0;p.grow=true;}}
      if(p.y<-5){p.y=cv.height;p.x=Math.random()*cv.width;}
    });
    requestAnimationFrame(draw);
  })();
}

// ‚ïê‚ïê HOME ANIMATE ‚ïê‚ïê
function animateHome(){
  an({targets:'#hero',opacity:[0,1],translateY:[20,0],duration:600,easing:'spring(1,80,12,0)'});
  an({targets:'.prayer-card',opacity:[0,1],translateY:[13,0],scale:[.97,1],delay:A?A.stagger(65,{start:200}):0,duration:480,easing:'spring(1,80,10,0)'});
  an({targets:'.amalan-row',opacity:[0,1],translateX:[-13,0],delay:A?A.stagger(60,{start:380}):0,duration:400,easing:'easeOutCubic'});
  an({targets:'.ayat-card',opacity:[0,1],translateY:[16,0],duration:480,delay:620,easing:'easeOutCubic'});
  setTimeout(()=>an({targets:'.am-ico',rotate:['-7deg','7deg'],duration:320,direction:'alternate',loop:2,delay:A?A.stagger(80,{start:0}):0,easing:'easeInOutSine'}),620);
}

// ‚ïê‚ïê TAB ‚ïê‚ïê
function switchTab(id,btn){
  if(A){
    const rip=document.createElement('div');rip.className='tab-ripple';
    rip.style.cssText='width:46px;height:46px;top:-13px;left:50%;margin-left:-23px';
    btn.appendChild(rip);
    A({targets:rip,scale:[0,2.6],opacity:[.5,0],duration:460,easing:'easeOutCubic',complete:()=>rip.remove()});
    A({targets:btn.querySelector('.ico'),scale:[1,1.38,1],duration:340,easing:'easeOutElastic(1,.4)'});
  }
  document.querySelectorAll('.tab-dot').forEach(d=>d.remove());
  const dot=document.createElement('div');dot.className='tab-dot';btn.appendChild(dot);
  an({targets:dot,scale:[0,1],duration:280,delay:70,easing:A?'spring(1,80,10,0)':'linear'});
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.querySelector('.content').scrollTo(0,0);
  setTimeout(()=>animatePage(id),40);
}

function animatePage(id){
  const pg=document.getElementById('page-'+id);
  const ttl=pg.querySelector('.page-title'),sub=pg.querySelector('.page-sub');
  if(ttl)an({targets:ttl,opacity:[0,1],translateY:[-10,0],duration:360,easing:'easeOutCubic'});
  if(sub)an({targets:sub,opacity:[0,1],translateY:[-6,0],duration:360,delay:60,easing:'easeOutCubic'});
  if(id==='jadwal'){renderTodayCard();renderMonthlyTable();an({targets:'#today-card .pr-row',opacity:[0,1],translateX:[-10,0],delay:A?A.stagger(42,{start:100}):0,duration:300,easing:'easeOutCubic'});}
  if(id==='kajian'){renderKajian();an({targets:'.kajian-card',opacity:[0,1],translateY:[16,0],scale:[.98,1],delay:A?A.stagger(70,{start:70}):0,duration:420,easing:A?'spring(1,80,10,0)':'linear'});}
  if(id==='doa'){renderDoa();an({targets:'.doa-card',opacity:[0,1],translateY:[13,0],delay:A?A.stagger(50,{start:70}):0,duration:360,easing:'easeOutCubic'});}
  if(id==='quran'){
    renderSurah();
    an({targets:'#prog-card',opacity:[0,1],translateY:[13,0],duration:360,delay:70,easing:'easeOutCubic'});
    const pct=parseInt(document.getElementById('prog-pct').textContent)||0;
    setTimeout(()=>{document.getElementById('prog-fill').style.width=pct+'%';},320);
    an({targets:'.surah-row',opacity:[0,1],translateX:[-10,0],delay:A?A.stagger(32,{start:160}):0,duration:320,easing:'easeOutCubic'});
  }
}

// ‚ïê‚ïê BURST ‚ïê‚ïê
function burstEmojis(x,y,emojis=['‚≠ê','‚ú®','üåô','üåü']){
  if(!A)return;
  for(let i=0;i<6;i++){
    const el=document.createElement('div');el.className='float-emoji';
    el.textContent=emojis[Math.floor(Math.random()*emojis.length)];
    el.style.cssText=`left:${x}px;top:${y}px;font-size:${18+Math.random()*10}px`;
    document.body.appendChild(el);
    A({targets:el,translateX:[(Math.random()-.5)*130],translateY:[-(Math.random()*110+30)],rotate:[`${(Math.random()-.5)*360}deg`],opacity:[1,0],scale:[.6,1.3,0],duration:900+Math.random()*400,easing:'easeOutCubic',complete:()=>el.remove()});
  }
}

// ‚ïê‚ïê CHECKBOX ‚ïê‚ïê
function toggleCheck(el){
  el.classList.toggle('checked');
  an({targets:el,scale:[1,1.32,1],duration:300,easing:A?'easeOutElastic(1,.4)':'linear'});
  if(el.classList.contains('checked')){const r=el.getBoundingClientRect();burstEmojis(r.left+r.width/2,r.top,['‚úÖ','‚≠ê','üí´','üåü']);}
}

// ‚ïê‚ïê THEME ‚ïê‚ïê
function toggleTheme(){
  isDark=!isDark;
  document.getElementById('app').classList.toggle('light',!isDark);
  document.getElementById('theme-icon').textContent=isDark?'üåô':'‚òÄÔ∏è';
  document.getElementById('sw-knob').classList.toggle('on',isDark);
  document.getElementById('meta-theme').content=isDark?'#0a0f1a':'#f7f2e8';
  const sw=document.querySelector('.sw-track'),r=sw.getBoundingClientRect();
  burstEmojis(r.left+r.width/2,r.top+r.height/2,isDark?['üåô','‚≠ê','‚ú®']:['‚òÄÔ∏è','üå§Ô∏è','‚ú®']);
}

// ‚ïê‚ïê PRAYER CALCULATOR ‚ïê‚ïê
function toRad(d){return d*Math.PI/180}function toDeg(r){return r*180/Math.PI}
function fixHour(a){return a-24*Math.floor(a/24)}function fixAngle(a){return a-360*Math.floor(a/360)}
function calcPrayerTimes(yr,mo,dy,lat,lng,tz){
  const JD=(()=>{let y=yr,m=mo,d=dy;if(m<=2){y--;m+=12;}const B=2-Math.floor(y/100)+Math.floor(Math.floor(y/100)/4);return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5})();
  const D=JD-2451545,g=fixAngle(357.529+0.9856*D),q=fixAngle(280.459+0.9856*D);
  const L=fixAngle(q+1.915*Math.sin(toRad(g))+0.02*Math.sin(toRad(2*g)));
  const e=23.439-0.00000036*D,RA=toDeg(Math.atan2(Math.cos(toRad(e))*Math.sin(toRad(L)),Math.cos(toRad(L))))/15;
  const EqT=q/15-fixHour(RA),decl=toDeg(Math.asin(Math.sin(toRad(e))*Math.sin(toRad(L))));
  function sat(angle,ccw){const ch=(-Math.sin(toRad(angle))-Math.sin(toRad(decl))*Math.sin(toRad(lat)))/(Math.cos(toRad(decl))*Math.cos(toRad(lat)));if(Math.abs(ch)>1)return null;const t=toDeg(Math.acos(ch))/15;return 12-EqT+(ccw?-t:t)-lng/15+tz;}
  function asr(){const a=toDeg(Math.atan(1/(1+Math.tan(toRad(Math.abs(lat-decl))))));return sat(-a,false)}
  function fmt(t){if(t==null)return'--:--';t=fixHour(t);const h=Math.floor(t),m=Math.floor((t-h)*60);return`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`}
  const dhuhr=12-EqT-lng/15+tz;
  return{Imsak:fmt(sat(20,true)!=null?sat(20,true)-10/60:null),Subuh:fmt(sat(20,true)),Syuruk:fmt(sat(-0.833,true)),Dzuhur:fmt(dhuhr+2/60),Ashar:fmt(asr()),Maghrib:fmt(sat(-0.833,false)),Isya:fmt(sat(18,false))}
}

// ‚ïê‚ïê DATA ‚ïê‚ïê
const CITIES=[
  {province:'DKI Jakarta',cities:[{name:'Jakarta Pusat',lat:-6.1744,lng:106.8294,tz:7},{name:'Jakarta Selatan',lat:-6.2615,lng:106.8106,tz:7},{name:'Jakarta Barat',lat:-6.1682,lng:106.7632,tz:7},{name:'Jakarta Timur',lat:-6.2251,lng:106.9004,tz:7},{name:'Jakarta Utara',lat:-6.1209,lng:106.9005,tz:7}]},
  {province:'Banten',cities:[{name:'Tangerang',lat:-6.1783,lng:106.6319,tz:7},{name:'Tangerang Selatan',lat:-6.2898,lng:106.7187,tz:7},{name:'Serang',lat:-6.1201,lng:106.1503,tz:7},{name:'Cilegon',lat:-6.0171,lng:106.0039,tz:7}]},
  {province:'Jawa Barat',cities:[{name:'Bandung',lat:-6.9175,lng:107.6191,tz:7},{name:'Bekasi',lat:-6.2349,lng:106.9896,tz:7},{name:'Depok',lat:-6.4025,lng:106.7942,tz:7},{name:'Bogor',lat:-6.5971,lng:106.806,tz:7},{name:'Cirebon',lat:-6.732,lng:108.5523,tz:7},{name:'Karawang',lat:-6.3216,lng:107.3381,tz:7}]},
  {province:'Jawa Tengah',cities:[{name:'Semarang',lat:-6.9932,lng:110.4203,tz:7},{name:'Solo',lat:-7.5755,lng:110.8243,tz:7},{name:'Magelang',lat:-7.4797,lng:110.2177,tz:7},{name:'Pekalongan',lat:-6.8886,lng:109.6753,tz:7},{name:'Purwokerto',lat:-7.421,lng:109.2345,tz:7}]},
  {province:'DI Yogyakarta',cities:[{name:'Yogyakarta',lat:-7.7956,lng:110.3695,tz:7},{name:'Sleman',lat:-7.7172,lng:110.3563,tz:7},{name:'Bantul',lat:-7.8916,lng:110.3295,tz:7}]},
  {province:'Jawa Timur',cities:[{name:'Surabaya',lat:-7.2504,lng:112.7688,tz:7},{name:'Malang',lat:-7.9839,lng:112.6214,tz:7},{name:'Sidoarjo',lat:-7.4462,lng:112.718,tz:7},{name:'Kediri',lat:-7.8235,lng:112.0115,tz:7},{name:'Jember',lat:-8.1724,lng:113.7008,tz:7},{name:'Banyuwangi',lat:-8.2191,lng:114.3691,tz:7}]},
  {province:'Aceh',cities:[{name:'Banda Aceh',lat:5.5483,lng:95.3238,tz:7},{name:'Lhokseumawe',lat:5.1802,lng:97.1501,tz:7}]},
  {province:'Sumatra Utara',cities:[{name:'Medan',lat:3.5952,lng:98.6722,tz:7},{name:'Pematangsiantar',lat:2.9595,lng:99.0687,tz:7}]},
  {province:'Sumatra Barat',cities:[{name:'Padang',lat:-0.9471,lng:100.4172,tz:7},{name:'Bukittinggi',lat:-0.3054,lng:100.3695,tz:7}]},
  {province:'Riau',cities:[{name:'Pekanbaru',lat:0.5071,lng:101.4478,tz:7},{name:'Dumai',lat:1.6641,lng:101.4453,tz:7}]},
  {province:'Kepulauan Riau',cities:[{name:'Batam',lat:1.1301,lng:104.0529,tz:7},{name:'Tanjung Pinang',lat:0.9189,lng:104.4653,tz:7}]},
  {province:'Sumatra Selatan',cities:[{name:'Palembang',lat:-2.9761,lng:104.7754,tz:7}]},
  {province:'Lampung',cities:[{name:'Bandar Lampung',lat:-5.3971,lng:105.2668,tz:7}]},
  {province:'Kalimantan Barat',cities:[{name:'Pontianak',lat:-0.0263,lng:109.3425,tz:7},{name:'Singkawang',lat:0.9069,lng:108.9859,tz:7}]},
  {province:'Kalimantan Selatan',cities:[{name:'Banjarmasin',lat:-3.3194,lng:114.5908,tz:8},{name:'Banjarbaru',lat:-3.442,lng:114.8306,tz:8}]},
  {province:'Kalimantan Timur',cities:[{name:'Samarinda',lat:-0.5022,lng:117.1536,tz:8},{name:'Balikpapan',lat:-1.2379,lng:116.8529,tz:8}]},
  {province:'Sulawesi Selatan',cities:[{name:'Makassar',lat:-5.1477,lng:119.4327,tz:8},{name:'Parepare',lat:-4.0135,lng:119.6318,tz:8},{name:'Palopo',lat:-2.993,lng:120.1943,tz:8}]},
  {province:'Sulawesi Utara',cities:[{name:'Manado',lat:1.4748,lng:124.8421,tz:8},{name:'Bitung',lat:1.4474,lng:125.1931,tz:8}]},
  {province:'Bali',cities:[{name:'Denpasar',lat:-8.6705,lng:115.2126,tz:8},{name:'Singaraja',lat:-8.1116,lng:115.0892,tz:8}]},
  {province:'Nusa Tenggara Barat',cities:[{name:'Mataram',lat:-8.5833,lng:116.1167,tz:8},{name:'Bima',lat:-8.4604,lng:118.7195,tz:8}]},
  {province:'Nusa Tenggara Timur',cities:[{name:'Kupang',lat:-10.1772,lng:123.6071,tz:8}]},
  {province:'Maluku',cities:[{name:'Ambon',lat:-3.6954,lng:128.1814,tz:9},{name:'Ternate',lat:0.7833,lng:127.3667,tz:9}]},
  {province:'Papua',cities:[{name:'Jayapura',lat:-2.5337,lng:140.7181,tz:9},{name:'Sorong',lat:-0.8817,lng:131.2617,tz:9},{name:'Merauke',lat:-8.4957,lng:140.4018,tz:9}]},
];
const KAJIAN=[
  {id:1,title:"Keutamaan 10 Hari Pertama Ramadhan",category:"Amalan",date:"18 Feb 2026",readTime:"5 menit",icon:"üåô",excerpt:"Sepuluh hari pertama Ramadhan merupakan hari-hari penuh rahmat. Pintu-pintu langit terbuka lebar...",content:"Allah SWT telah membagi Ramadhan menjadi tiga bagian yang masing-masing memiliki keistimewaan. Sepuluh hari pertama adalah hari-hari yang Allah curahkan rahmat-Nya kepada seluruh hamba.\n\nPerbanyaklah shalat sunnah, tilawah Al-Qur'an, dan sedekah di hari-hari penuh berkah ini. Rasulullah Ô∑∫ senantiasa meningkatkan amal ibadahnya sepanjang Ramadhan."},
  {id:2,title:"Rahasia Lailatul Qadar yang Tersembunyi",category:"Ilmu",date:"17 Feb 2026",readTime:"7 menit",icon:"‚ú®",excerpt:"Lailatul Qadar adalah malam yang lebih baik dari seribu bulan. Tersembunyi di malam-malam ganjil...",content:"Allah SWT merahasiakan malam Lailatul Qadar agar hamba-Nya bersungguh-sungguh mencarinya di setiap malam. Tandanya: udara sejuk, malam tenang, matahari terbit dengan sinar lemah lembut.\n\nRasulullah Ô∑∫ menganjurkan doa: 'Allahumma innaka 'afuwwun tuhibbul 'afwa fa'fu 'anni' pada setiap malam ganjil."},
  {id:3,title:"Panduan Lengkap I'tikaf di Masjid",category:"Fiqih",date:"16 Feb 2026",readTime:"8 menit",icon:"üïå",excerpt:"I'tikaf adalah berdiam diri di masjid dengan niat ibadah. Sangat dianjurkan pada 10 hari terakhir...",content:"I'tikaf memiliki syarat: berakal, suci dari hadas besar, dan berada di masjid. Selama i'tikaf, perbanyak dzikir, doa, dan tilawah.\n\nNabi Ô∑∫ senantiasa beri'tikaf pada sepuluh hari terakhir Ramadhan hingga beliau wafat."},
  {id:4,title:"Menghidupkan Malam dengan Qiyamul Lail",category:"Amalan",date:"15 Feb 2026",readTime:"4 menit",icon:"üåü",excerpt:"Shalat malam di bulan Ramadhan memiliki keutamaan luar biasa...",content:"Qiyamul Lail bisa dilakukan mulai dari dua rakaat hingga sebelas rakaat. Waktu terbaiknya sepertiga malam terakhir.\n\nRasulullah Ô∑∫: 'Barang siapa mendirikan shalat malam di bulan Ramadhan karena iman dan mengharap pahala, maka diampuni dosa-dosanya yang telah lalu.' (HR. Bukhari & Muslim)"},
  {id:5,title:"Adab dan Sunnah Berbuka Puasa",category:"Sunnah",date:"14 Feb 2026",readTime:"3 menit",icon:"üåÖ",excerpt:"Berbuka puasa adalah salah satu kegembiraan. Terdapat beberapa adab yang diajarkan...",content:"Sunnah berbuka: segera berbuka saat azan Maghrib, berbuka dengan kurma atau air putih, membaca doa, dan makan secukupnya.\n\nRasulullah Ô∑∫: 'Manusia senantiasa dalam kebaikan selama menyegerakan berbuka puasa.' (HR. Bukhari & Muslim)"},
];
const DOA=[
  {id:1,title:"Doa Berbuka Puasa",arabic:"ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÑŸéŸÉŸé ÿµŸèŸÖŸíÿ™Ÿè ŸàŸéÿ®ŸêŸÉŸé ÿ¢ŸÖŸéŸÜŸíÿ™Ÿè ŸàŸéÿπŸéŸÑŸéŸâ ÿ±Ÿêÿ≤ŸíŸÇŸêŸÉŸé ÿ£ŸéŸÅŸíÿ∑Ÿéÿ±Ÿíÿ™Ÿè",latin:"Allahumma laka shumtu wa bika aamantu wa 'ala rizqika afthartu",arti:"Ya Allah, karena-Mu aku berpuasa, kepada-Mu aku beriman, dan dengan rezeki-Mu aku berbuka."},
  {id:2,title:"Doa Niat Puasa",arabic:"ŸÜŸéŸàŸéŸäŸíÿ™Ÿè ÿµŸéŸàŸíŸÖŸé ÿ∫ŸéÿØŸç ÿπŸéŸÜŸí ÿ£ŸéÿØŸéÿßÿ°Ÿê ŸÅŸéÿ±Ÿíÿ∂Ÿê ÿ¥ŸéŸáŸíÿ±Ÿê ÿ±ŸéŸÖŸéÿ∂ŸéÿßŸÜŸé ŸáŸéÿ∞ŸêŸáŸê ÿßŸÑÿ≥ŸéŸëŸÜŸéÿ©Ÿê ŸÑŸêŸÑŸáŸê ÿ™ŸéÿπŸéÿßŸÑŸéŸâ",latin:"Nawaitu shauma ghadin 'an adaa'i fardhi syahri Ramadhana haadzihis sanati lillahi ta'alaa",arti:"Saya niat berpuasa esok hari untuk menunaikan kewajiban puasa di bulan Ramadhan tahun ini karena Allah Ta'ala."},
  {id:3,title:"Doa Lailatul Qadar",arabic:"ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä",latin:"Allahumma innaka 'afuwwun tuhibbul 'afwa fa'fu 'anni",arti:"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan mencintai maaf, maka maafkanlah aku."},
  {id:4,title:"Doa Setelah Sahur",arabic:"ŸàŸéÿ®ŸêÿµŸéŸàŸíŸÖŸê ÿ∫ŸéÿØŸç ŸÜŸéŸëŸàŸéŸäŸíÿ™Ÿè ŸÖŸêŸÜŸí ÿ¥ŸéŸáŸíÿ±Ÿê ÿ±ŸéŸÖŸéÿ∂ŸéÿßŸÜŸé",latin:"Wa bishaumi ghadin nawaytu min syahri Ramadhana",arti:"Dan aku berniat puasa esok hari dari bulan Ramadhan."},
  {id:5,title:"Doa Khatam Al-Quran",arabic:"ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ±Ÿíÿ≠ŸéŸÖŸíŸÜŸêŸä ÿ®ŸêÿßŸÑŸíŸÇŸèÿ±Ÿíÿ¢ŸÜŸê ŸàŸéÿßÿ¨ŸíÿπŸéŸÑŸíŸáŸè ŸÑŸêŸä ÿ•ŸêŸÖŸéÿßŸÖŸãÿß ŸàŸéŸÜŸèŸàÿ±Ÿãÿß ŸàŸéŸáŸèÿØŸãŸâ ŸàŸéÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿã",latin:"Allahummarhamni bil Qur'an waj'alhu li imaaman wa nuuran wa hudaw wa rahmatan",arti:"Ya Allah, rahmatilah aku dengan Al-Qur'an dan jadikan ia untukku pemimpin, cahaya, petunjuk, dan rahmat."},
  {id:6,title:"Doa Malam Ganjil",arabic:"ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ŸÉŸéÿ±ŸêŸäŸÖŸå ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸéŸëÿß",latin:"Allahumma innaka 'afuwwun kariim tuhibbul 'afwa fa'fu 'anna",arti:"Ya Allah, sesungguhnya Engkau Maha Pemaaf lagi Maha Mulia, mencintai maaf, maka maafkanlah kami."},
];
const SURAH=[{no:1,name:"Al-Fatihah",ar:"ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©",ayat:7,juz:1},{no:2,name:"Al-Baqarah",ar:"ÿßŸÑÿ®ŸÇÿ±ÿ©",ayat:286,juz:1},{no:3,name:"Ali 'Imran",ar:"ÿ¢ŸÑ ÿπŸÖÿ±ÿßŸÜ",ayat:200,juz:3},{no:4,name:"An-Nisa",ar:"ÿßŸÑŸÜÿ≥ÿßÿ°",ayat:176,juz:4},{no:5,name:"Al-Ma'idah",ar:"ÿßŸÑŸÖÿßÿ¶ÿØÿ©",ayat:120,juz:6},{no:36,name:"Yasin",ar:"Ÿäÿ≥",ayat:83,juz:22},{no:55,name:"Ar-Rahman",ar:"ÿßŸÑÿ±ÿ≠ŸÖŸÜ",ayat:78,juz:27},{no:67,name:"Al-Mulk",ar:"ÿßŸÑŸÖŸÑŸÉ",ayat:30,juz:29},{no:112,name:"Al-Ikhlas",ar:"ÿßŸÑÿ•ÿÆŸÑÿßÿµ",ayat:4,juz:30},{no:113,name:"Al-Falaq",ar:"ÿßŸÑŸÅŸÑŸÇ",ayat:5,juz:30},{no:114,name:"An-Nas",ar:"ÿßŸÑŸÜÿßÿ≥",ayat:6,juz:30}];
const PRAYER_ICONS={Imsak:'üåô',Subuh:'üåÖ',Syuruk:'‚òÄÔ∏è',Dzuhur:'üå§Ô∏è',Ashar:'‚õÖ',Maghrib:'üåá',Isya:'üåÉ'};
const MONTHS_ID=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];

let isDark=true,loc=CITIES[5].cities[0],times=null,nextPrayer='',expandedProv=null;

// ‚ïê‚ïê CLOCK ‚ïê‚ïê
function tickClock(){
  const n=new Date();
  document.getElementById('clock').textContent=`${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}`;
  if(!times)return;
  const ORDER=['Imsak','Subuh','Dzuhur','Ashar','Maghrib','Isya'];
  const cur=n.getHours()*60+n.getMinutes();
  let np=ORDER.find(p=>{const[h,m]=times[p].split(':').map(Number);return h*60+m>cur;})||'Imsak';
  nextPrayer=np;
  const[nh,nm]=np==='Imsak'?(()=>{const[h,m]=times['Imsak'].split(':').map(Number);return[h+24,m];})():times[np].split(':').map(Number);
  const diff=nh*60+nm-cur;
  const h=String(Math.floor(diff/60)).padStart(2,'0');
  const m2=String(diff%60).padStart(2,'0');
  const s=String(59-n.getSeconds()).padStart(2,'0');
  const cdH=document.getElementById('cd-h'),cdM=document.getElementById('cd-m'),cdS=document.getElementById('cd-s');
  if(cdH&&cdH.textContent!==h)flip(cdH,h);
  if(cdM&&cdM.textContent!==m2)flip(cdM,m2);
  if(cdS&&cdS.textContent!==s)flip(cdS,s);
  document.getElementById('next-label').textContent=np==='Maghrib'?'‚è≥ Menuju Waktu Berbuka':np==='Imsak'?'‚è≥ Menuju Imsak':`‚è≥ Menuju ${np}`;
  document.querySelectorAll('.prayer-card').forEach(el=>el.classList.toggle('next',el.dataset.name===np));
  document.querySelectorAll('.pr-row').forEach(el=>el.classList.toggle('next-row',el.dataset.name===np));
}
function flip(el,val){an({targets:el,translateY:['-55%','0%'],opacity:[0,1],duration:170,easing:'easeOutCubic',begin:()=>{el.textContent=val;}});}

// ‚ïê‚ïê INIT ‚ïê‚ïê
function init(){
  const n=new Date();
  document.getElementById('hero-date').textContent=`${n.getDate()} ${MONTHS_ID[n.getMonth()]} ${n.getFullYear()}`;
  try{document.getElementById('hero-hijri').textContent=new Intl.DateTimeFormat('id-ID-u-ca-islamic-umalqura',{day:'numeric',month:'long',year:'numeric'}).format(n);}
  catch(e){document.getElementById('hero-hijri').textContent="Sya'ban 1447 H";}
  const ramStart=new Date(2026,1,28),diff=Math.floor((n-ramStart)/86400000),ramDay=diff>=0&&diff<30?diff+1:null;
  if(ramDay){
    document.getElementById('ram-badge-wrap').innerHTML=`<div class="ram-badge">Ramadan Hari ke-${ramDay}</div>`;
    const pct=Math.round((ramDay/30)*100);
    document.getElementById('prog-text').textContent=`Hari ${ramDay} ‚Äî Juz ${ramDay}/30`;
    document.getElementById('prog-pct').textContent=`${pct}%`;
  }
  updateLocation();
  setInterval(tickClock,1000);tickClock();
}

function updateLocation(){
  const d=new Date();
  times=calcPrayerTimes(d.getFullYear(),d.getMonth()+1,d.getDate(),loc.lat,loc.lng,loc.tz);
  ['loc-name-home','loc-name-jadwal','modal-current'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=loc.name;});
  const tzEl=document.getElementById('tz-label');if(tzEl)tzEl.textContent='WIB'+(loc.tz>7?`+${loc.tz-7}`:'');
  renderQuickGrid();
  if(document.getElementById('page-jadwal').classList.contains('active')){renderTodayCard();renderMonthlyTable();}
}

function renderQuickGrid(){
  document.getElementById('quick-grid').innerHTML=['Imsak','Subuh','Maghrib','Isya'].map(name=>`
    <div class="prayer-card${name===nextPrayer?' next':''}" data-name="${name}">
      <div class="pc-top"><span style="font-size:18px">${PRAYER_ICONS[name]}</span>${name===nextPrayer?'<span class="next-badge">NEXT</span>':''}</div>
      <div class="pc-name">${name}</div><div class="pc-time">${times[name]}</div>
    </div>`).join('');
  an({targets:'.prayer-card',opacity:[0,1],translateY:[12,0],scale:[.97,1],delay:A?A.stagger(65):0,duration:440,easing:A?'spring(1,80,10,0)':'linear'});
}

function renderTodayCard(){
  const n=new Date(),todayStr=`${n.getDate()} ${MONTHS_ID[n.getMonth()]} ${n.getFullYear()}`;
  document.getElementById('today-card').innerHTML=`<div class="card-header-strip"><span style="color:var(--gold);font-weight:600;font-size:12px">Hari Ini ‚Äî ${todayStr}</span></div>
    ${Object.entries(times).map(([name,time])=>`<div class="pr-row${name===nextPrayer?' next-row':''}" data-name="${name}">
      <span class="pr-ico">${PRAYER_ICONS[name]||'üåô'}</span><span class="pr-name">${name}</span>
      ${name===nextPrayer?'<span class="next-badge" style="margin-right:10px">NEXT</span>':''}
      <span class="pr-time">${time}</span></div>`).join('')}`;
}

function renderMonthlyTable(){
  const ramStart=new Date(2026,1,28),todayDiff=Math.floor((new Date()-ramStart)/86400000),ramDay=todayDiff>=0&&todayDiff<30?todayDiff+1:null;
  document.getElementById('monthly-table').innerHTML=Array.from({length:30},(_,i)=>{
    const d=new Date(2026,1,28+i);
    const t=calcPrayerTimes(d.getFullYear(),d.getMonth()+1,d.getDate(),loc.lat,loc.lng,loc.tz);
    const today=ramDay===i+1;
    return`<div class="tr${today?' today-row':''}"><div class="td num">${i+1}</div><div class="td">${d.getDate()} ${MONTHS_ID[d.getMonth()]}</div><div class="td" style="font-family:monospace">${t.Imsak}</div><div class="td" style="font-family:monospace">${t.Subuh}</div><div class="td buka" style="font-family:monospace">${t.Maghrib}</div></div>`;
  }).join('');
}

function renderKajian(){
  document.getElementById('kajian-list').innerHTML=KAJIAN.map(item=>`
    <div class="kajian-card" onclick="openKajian(${item.id})">
      <div class="kjt"><div class="kj-top"><span style="font-size:26px">${item.icon}</span><span class="cat-badge">${item.category}</span></div><div class="kj-title">${item.title}</div></div>
      <div class="kjb"><div class="kj-exc">${item.excerpt}</div><div class="kj-footer"><span class="kj-meta">üìÖ ${item.date} ¬∑ ‚è± ${item.readTime}</span><span class="kj-read">Baca ‚Üí</span></div></div>
    </div>`).join('');
}
function openKajian(id){
  const item=KAJIAN.find(k=>k.id===id);
  function show(){
    document.getElementById('kajian-list-view').style.display='none';
    document.getElementById('kajian-detail-view').style.display='block';
    document.getElementById('kajian-detail').innerHTML=`<div class="detail-head"><div style="display:flex;align-items:center;gap:10px;margin-bottom:11px"><span style="font-size:28px">${item.icon}</span><span style="background:var(--acc);border:1px solid var(--accB);border-radius:10px;padding:3px 11px;color:var(--gold);font-size:10px;font-weight:700">${item.category}</span></div><div style="font-size:18px;font-weight:700;color:var(--text);line-height:1.4;margin-bottom:7px">${item.title}</div><div style="font-size:11px;color:var(--mute)">üìÖ ${item.date} ¬∑ ‚è± ${item.readTime}</div></div><div class="detail-body"><div class="detail-content">${item.content}</div></div>`;
    an({targets:'.detail-card',opacity:[0,1],translateY:[14,0],duration:360,easing:A?'spring(1,80,12,0)':'linear'});
    document.querySelector('.content').scrollTo(0,0);
  }
  if(A)an({targets:'#kajian-list-view',opacity:[1,0],translateX:[0,-18],duration:170,easing:'easeInCubic',complete:show});
  else show();
}
function closeKajian(){
  function show(){
    document.getElementById('kajian-list-view').style.display='block';
    document.getElementById('kajian-detail-view').style.display='none';
    an({targets:'#kajian-list-view',opacity:[0,1],translateX:[-16,0],duration:260,easing:'easeOutCubic'});
    an({targets:'.kajian-card',opacity:[0,1],translateY:[13,0],delay:A?A.stagger(52):0,duration:300,easing:'easeOutCubic'});
  }
  if(A)an({targets:'#kajian-detail-view',opacity:[1,0],translateX:[0,18],duration:170,easing:'easeInCubic',complete:show});
  else show();
}

function renderDoa(){
  document.getElementById('doa-list').innerHTML=DOA.map(doa=>`
    <div class="doa-card" onclick="openDoa(${doa.id})">
      <div class="doa-top"><span class="doa-title">${doa.title}</span><span style="color:var(--gold);font-size:18px">‚Ä∫</span></div>
      <div class="doa-ar">${doa.arabic}</div><div class="doa-arti">${doa.arti}</div>
    </div>`).join('');
}
function openDoa(id){
  const doa=DOA.find(d=>d.id===id);
  function show(){
    document.getElementById('doa-list-view').style.display='none';
    document.getElementById('doa-detail-view').style.display='block';
    document.getElementById('doa-detail').innerHTML=`<div style="border:1px solid var(--accB);border-radius:20px;overflow:hidden" id="doa-dc"><div style="padding:17px 20px;background:var(--acc)"><div style="font-size:17px;font-weight:700;color:var(--cnt)">${doa.title}</div></div><div style="padding:19px;background:var(--card)"><div class="arabic-box"><div class="arabic-full">${doa.arabic}</div></div><div class="field-label">LATIN</div><div class="latin-txt">${doa.latin}</div><div class="field-label">ARTINYA</div><div class="arti-txt">${doa.arti}</div><button class="copy-btn" id="copy-btn-${doa.id}" onclick="copyDoa(${doa.id})">üìã Salin Doa</button></div></div>`;
    an({targets:'#doa-dc',opacity:[0,1],translateY:[13,0],duration:360,easing:A?'spring(1,80,12,0)':'linear'});
    an({targets:'.arabic-full',opacity:[0,1],translateX:[16,0],duration:420,delay:120,easing:'easeOutCubic'});
    document.querySelector('.content').scrollTo(0,0);
  }
  if(A)an({targets:'#doa-list-view',opacity:[1,0],translateX:[0,-18],duration:170,easing:'easeInCubic',complete:show});
  else show();
}
function closeDoa(){
  function show(){
    document.getElementById('doa-list-view').style.display='block';
    document.getElementById('doa-detail-view').style.display='none';
    an({targets:'#doa-list-view',opacity:[0,1],translateX:[-16,0],duration:260,easing:'easeOutCubic'});
    an({targets:'.doa-card',opacity:[0,1],translateY:[11,0],delay:A?A.stagger(44):0,duration:280,easing:'easeOutCubic'});
  }
  if(A)an({targets:'#doa-detail-view',opacity:[1,0],translateX:[0,18],duration:170,easing:'easeInCubic',complete:show});
  else show();
}
function copyDoa(id){
  const doa=DOA.find(d=>d.id===id);
  navigator.clipboard.writeText(`${doa.arabic}\n\n${doa.latin}\n\nArtinya: ${doa.arti}`).then(()=>{
    const btn=document.getElementById('copy-btn-'+id);
    btn.textContent='‚úì Berhasil Disalin!';btn.classList.add('copied');
    an({targets:btn,scale:[1,1.06,1],duration:280,easing:A?'easeOutElastic(1,.4)':'linear'});
    const r=btn.getBoundingClientRect();burstEmojis(r.left+r.width/2,r.top,['üìã','‚úÖ','üåü','üí´']);
    setTimeout(()=>{btn.textContent='üìã Salin Doa';btn.classList.remove('copied');},2200);
  }).catch(()=>alert('Salin gagal, coba tekan lama teks doa.'));
}

function renderSurah(){
  document.getElementById('surah-list').innerHTML=SURAH.map(s=>`
    <div class="surah-row"><div class="surah-num"><span style="color:var(--goldD);font-size:11px;font-weight:700">${s.no}</span></div>
    <div style="flex:1"><div style="font-size:13px;font-weight:500;color:var(--text)">${s.name}</div><div style="font-size:11px;color:var(--mute);margin-top:1px">${s.ayat} Ayat ¬∑ Juz ${s.juz}</div></div>
    <div class="surah-ar">${s.ar}</div></div>`).join('');
}

function openModal(){
  document.getElementById('loc-modal').classList.add('open');
  renderProvList();
}
function closeModal(){
  document.getElementById('loc-modal').classList.remove('open');
  document.getElementById('loc-search').value='';expandedProv=null;
}
function handleOverlayClick(e){if(e.target===document.getElementById('loc-modal'))closeModal();}

function renderProvList(){
  document.getElementById('modal-list').innerHTML=CITIES.map(prov=>{
    const isExp=expandedProv===prov.province,hasActive=prov.cities.some(c=>c.name===loc.name);
    return`<div class="prov-row" onclick="toggleProv('${prov.province}')"><div class="prov-left"><span class="prov-name">${prov.province}</span>${hasActive?'<span class="active-badge">AKTIF</span>':''}</div><div class="prov-right"><span class="prov-count">${prov.cities.length} kota</span><span class="chevron${isExp?' open':''}">‚Ä∫</span></div></div>
    ${isExp?prov.cities.map(city=>`<div class="city-row" onclick="selectCity('${prov.province}','${city.name}')"><div><div class="city-name${city.name===loc.name?' active-city':''}">${city.name}</div><div class="city-tz">Zona WIB${city.tz>7?`+${city.tz-7}`:''}</div></div>${city.name===loc.name?'<span class="check">‚úì</span>':''}</div>`).join(''):''}`;
  }).join('');
  if(expandedProv)an({targets:'.city-row',opacity:[0,1],translateX:[-7,0],delay:A?A.stagger(33):0,duration:210,easing:'easeOutCubic'});
}
function toggleProv(p){expandedProv=expandedProv===p?null:p;renderProvList();}
function selectCity(province,cityName){
  const prov=CITIES.find(p=>p.province===province);
  loc=prov.cities.find(c=>c.name===cityName);
  updateLocation();
  const lb=document.querySelector('.loc-btn');
  if(lb){const r=lb.getBoundingClientRect();burstEmojis(r.left+r.width/2,r.top,['üìç','üåô','‚≠ê']);}
  closeModal();
}
function renderSearch(){
  const q=document.getElementById('loc-search').value.trim().toLowerCase();
  if(!q){renderProvList();return;}
  const res=CITIES.flatMap(p=>p.cities.filter(c=>c.name.toLowerCase().includes(q)).map(c=>({...c,province:p.province})));
  document.getElementById('modal-list').innerHTML=!res.length?'<div class="empty-search">Kota tidak ditemukan üîç</div>':
    res.map(city=>`<div class="city-row" style="padding-left:20px" onclick="selectCity('${city.province}','${city.name}')"><div><div class="city-name${city.name===loc.name?' active-city':''}">${city.name}</div><div class="city-tz">${city.province} ¬∑ WIB${city.tz>7?`+${city.tz-7}`:''}</div></div>${city.name===loc.name?'<span class="check">‚úì</span>':''}</div>`).join('');
  an({targets:'.city-row',opacity:[0,1],translateY:[7,0],delay:A?A.stagger(33):0,duration:210,easing:'easeOutCubic'});
}

let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;setTimeout(()=>document.getElementById('install-banner').classList.add('show'),4000);});
document.getElementById('install-btn').addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;document.getElementById('install-banner').classList.remove('show');});
if('serviceWorker' in navigator)navigator.serviceWorker.register('/ramadhan/sw.js').catch(()=>{});
</script>
</body>
</html>
